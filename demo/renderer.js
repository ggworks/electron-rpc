(()=>{var e={102:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const s=n(475);class r{constructor(e,t){this.ipcRenderer=e,this.remoteCtx={id:t}}remoteContext(){return this.remoteCtx}send(...e){this.ipcRenderer.send("rpc:message",...e)}on(e){this.ipcRenderer.on("rpc:message",((t,...n)=>{e(...n)}))}}class o extends s.RpcClient{constructor(e,t){super(new r(e,"rpc:main"),t),e.send("rpc:hello"),e.on("rpc:hello",(()=>{console.log("Client get rpc:hello")}))}}t.Client=o},473:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createProxyService=void 0,t.createProxyService=function(e,t){return new Proxy({},{get(n,s){if("string"==typeof s)return"on"===s?(n,s)=>e.listen(t,n,s):"once"===s?(n,s)=>e.listen(t,n,s,!0):"off"===s?(n,s)=>e.unlisten(t,n,s):(...n)=>e.call(t,s,n)}})}},475:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RpcClient=t.RpcServer=t.createRpcService=void 0;class n{constructor(e){this.service=e}call(e,t,n){const s=this.service,r=s[t];if("function"==typeof r)return r.apply(s,n);throw new Error(`method not found: ${t}`)}listen(e,t,n){this.call(e,"on",[t,n])}unlisten(e,t,n){this.call(e,"off",[t,n])}}t.createRpcService=function(e){return new n(e)},t.RpcServer=class{constructor(e){this.ctx=e,this.services=new Map,this.connections=new Set,this.activeRequests=new Map,this.eventHandlers=new Map,this.eventRoutes=new Map}addConnection(e){this.connections.add(e),e.on(((...t)=>{const[n,s,...r]=t;this.onRawMessage(e,n,s,r)})),this.activeRequests.set(e,new Set)}registerService(e,t){this.services.set(e,t)}call(e,t,n,s){const r=this.services.get(t);if(r){let t=r.call(e,n,s);return(!(o=t)||"object"!=typeof o&&"function"!=typeof o||"function"!=typeof o.then)&&(t=Promise.resolve(t)),t}throw new Error(`service not found: ${t}`);var o}listen(e,t,n,s){const r=this.services.get(t);if(!r)throw new Error(`service not found: ${t}`);r.listen(e,n,s)}unlisten(e,t,n,s){const r=this.services.get(t);if(!r)throw new Error(`service not found: ${t}`);r.unlisten(e,n,s)}onRawMessage(e,t,n,s){switch(t){case 100:{const[t,r,o]=s;return this.onPromise(e,n,t,r,o)}case 102:{const[t,r,o]=s;return this.onEventListen(e,n,t,r,o)}case 103:{const[t,r,o]=s;return this.onEventUnlisten(e,n,t,r,o)}}}onPromise(e,t,n,s,r){var o;let i;null===(o=this.activeRequests.get(e))||void 0===o||o.add(t);try{i=this.call(e.remoteContext(),n,s,r)}catch(e){i=Promise.reject(e)}i.then((n=>{var s;this.sendResponse(e,201,t,n),null===(s=this.activeRequests.get(e))||void 0===s||s.delete(t)}),(n=>{var s;n instanceof Error?this.sendResponse(e,202,t,{message:n.message,name:n.name,stack:n.stack?n.stack.split?n.stack.split("\n"):n.stack:void 0}):this.sendResponse(e,203,t,n),null===(s=this.activeRequests.get(e))||void 0===s||s.delete(t)}))}onEventListen(e,t,n,s,r){const o=`${n}.${s}`,i=this.eventRoutes.get(o)||[];if(i.includes(e)||(i.push(e),this.eventRoutes.set(o,i)),!this.eventHandlers.has(o)){const t=new Map,r=t=>{this.sendResponse(e,204,o,[n,s,t])};t.set(e,r),this.eventHandlers.set(o,t),this.listen(e.remoteContext(),n,s,r)}}onEventUnlisten(e,t,n,s,r){const o=`${n}.${s}`,i=this.eventHandlers.get(o);if(i){const t=i.get(e);t&&(this.unlisten(e.remoteContext(),n,s,t),i.delete(e))}const c=this.eventRoutes.get(o);c&&(c.splice(c.indexOf(e),1),this.eventRoutes.set(o,c),c.length||(this.eventRoutes.delete(o),this.eventHandlers.delete(o)))}sendResponse(e,t,n,s){e.send(t,n,s)}},t.RpcClient=class{constructor(e,t){this.connection=e,this._events=t,this.requestId=1,this.handlers=new Map,this.connection.on(((...e)=>{const[t,n,...s]=e;this.onRawMessage(t,n,...s)}))}call(e,t,n){return this.requestPromise(e,t,n)}listen(e,t,n,s){const r=`${e}.${t}`;s?this._events.once(r,n):this._events.on(r,n),1===this._events.listenerCount(r)&&this.requestEventListen(e,t)}unlisten(e,t,n){const s=`${e}.${t}`;this._events.off(s,n),0===this._events.listenerCount(s)&&this.requestEventUnlisten(e,t)}requestPromise(e,t,n){const s=this.requestId++,r=new Promise(((r,o)=>{this.connection.send(100,s,e,t,n),this.handlers.set(s,((e,t,n)=>{switch(e){case 201:this.handlers.delete(t),r(n);break;case 202:this.handlers.delete(t);const e=new Error(n.message);e.stack=n.stack,e.name=n.name,o(n);break;case 203:this.handlers.delete(t),o(n)}}))}));return r}requestEventListen(e,t,n){const s=this.requestId++;this.connection.send(102,s,e,t,n)}requestEventUnlisten(e,t,n){const s=this.requestId++;this.connection.send(103,s,e,t,n)}onEventFire(e,t,n){this._events.emit(`${e}.${t}`,n)}onRawMessage(e,t,...n){const s=e;switch(s){case 201:case 202:case 203:{const[e]=n,r=this.handlers.get(t);null==r||r(s,t,e);break}case 204:{const[e,t,s]=n[0];this.onEventFire(e,t,s);break}}}}},34:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function s(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,s,o,i){if("function"!=typeof s)throw new TypeError("The listener must be a function");var c=new r(s,o||e,i),a=n?n+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function i(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function c(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),c.prototype.eventNames=function(){var e,s,r=[];if(0===this._eventsCount)return r;for(s in e=this._events)t.call(e,s)&&r.push(n?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=n?n+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,o=s.length,i=new Array(o);r<o;r++)i[r]=s[r].fn;return i},c.prototype.listenerCount=function(e){var t=n?n+e:e,s=this._events[t];return s?s.fn?1:s.length:0},c.prototype.emit=function(e,t,s,r,o,i){var c=n?n+e:e;if(!this._events[c])return!1;var a,l,h=this._events[c],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,s),!0;case 4:return h.fn.call(h.context,t,s,r),!0;case 5:return h.fn.call(h.context,t,s,r,o),!0;case 6:return h.fn.call(h.context,t,s,r,o,i),!0}for(l=1,a=new Array(u-1);l<u;l++)a[l-1]=arguments[l];h.fn.apply(h.context,a)}else{var v,f=h.length;for(l=0;l<f;l++)switch(h[l].once&&this.removeListener(e,h[l].fn,void 0,!0),u){case 1:h[l].fn.call(h[l].context);break;case 2:h[l].fn.call(h[l].context,t);break;case 3:h[l].fn.call(h[l].context,t,s);break;case 4:h[l].fn.call(h[l].context,t,s,r);break;default:if(!a)for(v=1,a=new Array(u-1);v<u;v++)a[v-1]=arguments[v];h[l].fn.apply(h[l].context,a)}}return!0},c.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,s,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return i(this,o),this;var c=this._events[o];if(c.fn)c.fn!==t||r&&!c.once||s&&c.context!==s||i(this,o);else{for(var a=0,l=[],h=c.length;a<h;a++)(c[a].fn!==t||r&&!c[a].once||s&&c[a].context!==s)&&l.push(c[a]);l.length?this._events[o]=1===l.length?l[0]:l:i(this,o)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,e.exports=c},107:(e,t,n)=>{const{Client:s}=n(102),{createProxyService:r}=n(473),{createRpcService:o,RpcServer:i,RpcClient:c,RpcMessageType:a}=n(475);e.exports={Client:s,createProxyService:r,createRpcService:o,RpcServer:i,RpcClient:c,RpcMessageType:a}}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,n),o.exports}(()=>{const{Client:e,createProxyService:t}=n(107),s=n(34),r=new e(window.ipcRenderer,new s),o=e=>t(r,e),i=e=>{document.getElementById("result").innerText=JSON.stringify(e,null,2)},c={maximize:()=>{o("window").maximize()},restore:()=>{o("window").restore()},test:async()=>{const e=o("window");e.once("blur",(()=>{i("blur")}));let t=0;const n=()=>{t+=1,i(`focus ${t}`),t>=4&&e.off("focus",n)};e.on("focus",n),e.on("resize",(e=>{i(e)}))}};["maximize","restore","test"].forEach((e=>{document.getElementById(e).addEventListener("click",(()=>{const t=c[e];t&&t()}))}))})()})();