(()=>{var e={102:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const s=n(475);class r{constructor(e,t){this.ipcRenderer=e,this.remoteCtx={id:t}}remoteContext(){return this.remoteCtx}send(...e){this.ipcRenderer.send("rpc:message",...e)}on(e){this.ipcRenderer.on("rpc:message",((t,...n)=>{e(...n)}))}}class i extends s.RpcClient{constructor(e,t){super(new r(e,"rpc:main"),t),e.send("rpc:hello"),e.on("rpc:hello",(()=>{console.log("Client get rpc:hello")}))}}t.Client=i},473:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createProxyService=t.asProxyService=void 0;const s=n(475);t.asProxyService=s.ProxyHelper.asProxyService,t.createProxyService=s.ProxyHelper.createProxyService},475:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RpcClient=t.RpcServer=t.ProxyHelper=t.markDynamicService=t.createRpcService=void 0;class n{constructor(e){this.service=e}call(e,t,n){const s=this.service,r=s[t];if("function"==typeof r)return r.apply(s,n);throw new Error(`method not found: ${t}`)}listen(e,t,n){this.call(e,"on",[t,n])}unlisten(e,t,n){this.call(e,"off",[t,n])}}function s(e){return new n(e)}t.createRpcService=s;class r{constructor(){this.nextId=0,this.services={},this.ids=new WeakMap}add(e,t){const n=this.save(e);return this.services[n].connections.add(t),n}deref(e,t){const n=this.services[e];n&&(n.connections.delete(t),0===n.connections.size&&(this.ids.delete(n.object),delete this.services[e]))}save(e){let t=this.ids.get(e);return t||(t=++this.nextId,this.services[t]={object:e,connections:new Set}),t}}function i(e){return e.__rpc_dyn__=!0,e}t.markDynamicService=i;class o{constructor(e){this.objectCache=new Map,this.finalizationRegistry=new FinalizationRegistry((t=>{const n=this.objectCache.get(t);void 0!==n&&void 0===n.deref()&&(this.objectCache.delete(t),e(t))}))}add(e,t){const n=new WeakRef(t);this.objectCache.set(e,n),this.finalizationRegistry.register(t,e)}get(e){const t=this.objectCache.get(e);if(void 0!==t){const e=t.deref();if(void 0!==e)return e}}}var c;!function(e){e.asProxyService=function(e){return e},e.createProxyService=function(e,t,n){return new Proxy({},{get(s,r){var i;if("string"==typeof r){if(null===(i=null==n?void 0:n.properties)||void 0===i?void 0:i.has(r))return n.properties.get(r);if("then"===r)return;return"on"===r?(n,s)=>e.listen(t,n,s):"once"===r?(n,s)=>e.listen(t,n,s,!0):"off"===r?(n,s)=>e.unlisten(t,n,s):(...n)=>e.call(t,r,n)}}})}}(c=t.ProxyHelper||(t.ProxyHelper={})),t.RpcServer=class{constructor(e){this.ctx=e,this.services=new Map,this.connections=new Set,this.activeRequests=new Map,this.eventHandlers=new Map,this.eventRoutes=new Map,this.dynamicServices=new r}addConnection(e){this.connections.add(e),e.on(((...t)=>{const[n,s,...r]=t;this.onRawMessage(e,n,s,r)})),this.activeRequests.set(e,new Set)}registerService(e,t){this.services.set(e,t)}call(e,t,n,s){const r=this.services.get(t);if(r){let t=r.call(e,n,s);return(!(i=t)||"object"!=typeof i&&"function"!=typeof i||"function"!=typeof i.then)&&(t=Promise.resolve(t)),t}throw new Error(`service not found: ${t}`);var i}listen(e,t,n,s){const r=this.services.get(t);if(!r)throw new Error(`service not found: ${t}`);r.listen(e,n,s)}unlisten(e,t,n,s){const r=this.services.get(t);if(!r)throw new Error(`service not found: ${t}`);r.unlisten(e,n,s)}onRawMessage(e,t,n,s){switch(t){case 100:{const[t,r,i]=s;return this.onPromise(e,n,t,r,i)}case 102:{const[t,r,i]=s;return this.onEventListen(e,n,t,r,i)}case 103:{const[t,r,i]=s;return this.onEventUnlisten(e,n,t,r,i)}case 110:{const[t,n,r]=s;return this.onDeref(e,r)}}}saveDynamicService(e,t){const n=this.dynamicServices.add(e,t),r=`__rpc_dyn__${n}`;return this.services.get(r)||("call"in e&&"function"==typeof e.call?this.registerService(r,e):this.registerService(r,i(s(e)))),{id:n,name:r}}onDeref(e,t){this.dynamicServices.deref(t,e)}onPromise(e,t,n,s,r){var i;let o;null===(i=this.activeRequests.get(e))||void 0===i||i.add(t);try{o=this.call(e.remoteContext(),n,s,r)}catch(e){o=Promise.reject(e)}o.then((n=>{var s;if(n&&n.__rpc_dyn__){const s=this.saveDynamicService(n,e);this.sendResponse(e,201,t,{data:s,rpc:{dynamicId:s.id}})}else this.sendResponse(e,201,t,{data:n});null===(s=this.activeRequests.get(e))||void 0===s||s.delete(t)}),(n=>{var s;n instanceof Error?this.sendResponse(e,202,t,{message:n.message,name:n.name,stack:n.stack?n.stack.split?n.stack.split("\n"):n.stack:void 0}):this.sendResponse(e,203,t,n),null===(s=this.activeRequests.get(e))||void 0===s||s.delete(t)}))}onEventListen(e,t,n,s,r){const i=`${n}.${s}`,o=this.eventRoutes.get(i)||[];if(o.includes(e)||(o.push(e),this.eventRoutes.set(i,o)),this.eventHandlers.has(i)){const t=this.eventHandlers.get(i),r=t=>{this.sendResponse(e,204,i,[n,s,t])};t.set(e,r),this.eventHandlers.set(i,t)}else{const t=new Map,r=t=>{this.sendResponse(e,204,i,[n,s,t])};t.set(e,r),this.eventHandlers.set(i,t),this.listen(e.remoteContext(),n,s,r)}}onEventUnlisten(e,t,n,s,r){const i=`${n}.${s}`,o=this.eventHandlers.get(i);if(o){const t=o.get(e);t&&(this.unlisten(e.remoteContext(),n,s,t),o.delete(e))}const c=this.eventRoutes.get(i);c&&(c.splice(c.indexOf(e),1),this.eventRoutes.set(i,c),c.length||(this.eventRoutes.delete(i),this.eventHandlers.delete(i)))}sendResponse(e,t,n,s){e.send(t,n,s)}},t.RpcClient=class{constructor(e,t){this.connection=e,this._events=t,this.requestId=0,this.handlers=new Map,this.connection.on(((...e)=>{const[t,n,...s]=e;this.onRawMessage(t,n,...s)})),this.objectRegistry=new o((e=>{this.connection.send(110,++this.requestId,"rpc","deref",e)}))}call(e,t,n){return this.requestPromise(e,t,n)}listen(e,t,n,s){const r=`${e}.${t}`;s?this._events.once(r,n):this._events.on(r,n),1===this._events.listenerCount(r)&&this.requestEventListen(e,t)}unlisten(e,t,n){const s=`${e}.${t}`;this._events.off(s,n),0===this._events.listenerCount(s)&&this.requestEventUnlisten(e,t)}requestPromise(e,t,n){const s=++this.requestId,r=new Promise(((r,i)=>{this.connection.send(100,s,e,t,n),this.handlers.set(s,((e,t,n)=>{switch(e){case 201:{this.handlers.delete(t);const e=n;if(e.rpc){const{name:t}=e.data,{dynamicId:n}=e.rpc,s=new Map;s.set("__rpc__",{dynamicId:n,name:t});const i=c.createProxyService(this,t,{properties:s});this.objectRegistry.get(n)||this.objectRegistry.add(n,i),r(i)}else r(e.data)}break;case 202:{this.handlers.delete(t);const e=n,s=new Error(e.message);s.stack=e.stack,s.name=e.name,i(e)}break;case 203:this.handlers.delete(t),i(n)}}))}));return r}requestEventListen(e,t,n){const s=this.requestId++;this.connection.send(102,s,e,t,n)}requestEventUnlisten(e,t,n){const s=this.requestId++;this.connection.send(103,s,e,t,n)}onEventFire(e,t,n){this._events.emit(`${e}.${t}`,n)}onRawMessage(e,t,...n){const s=e;switch(s){case 201:case 202:case 203:{const[e]=n,r=this.handlers.get(t);null==r||r(s,t,e);break}case 204:{const[e,t,s]=n[0];this.onEventFire(e,t,s);break}}}}},34:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function s(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(e,t,s,i,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var c=new r(s,i||e,o),a=n?n+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function c(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),c.prototype.eventNames=function(){var e,s,r=[];if(0===this._eventsCount)return r;for(s in e=this._events)t.call(e,s)&&r.push(n?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},c.prototype.listeners=function(e){var t=n?n+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,i=s.length,o=new Array(i);r<i;r++)o[r]=s[r].fn;return o},c.prototype.listenerCount=function(e){var t=n?n+e:e,s=this._events[t];return s?s.fn?1:s.length:0},c.prototype.emit=function(e,t,s,r,i,o){var c=n?n+e:e;if(!this._events[c])return!1;var a,l,h=this._events[c],v=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),v){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,s),!0;case 4:return h.fn.call(h.context,t,s,r),!0;case 5:return h.fn.call(h.context,t,s,r,i),!0;case 6:return h.fn.call(h.context,t,s,r,i,o),!0}for(l=1,a=new Array(v-1);l<v;l++)a[l-1]=arguments[l];h.fn.apply(h.context,a)}else{var u,d=h.length;for(l=0;l<d;l++)switch(h[l].once&&this.removeListener(e,h[l].fn,void 0,!0),v){case 1:h[l].fn.call(h[l].context);break;case 2:h[l].fn.call(h[l].context,t);break;case 3:h[l].fn.call(h[l].context,t,s);break;case 4:h[l].fn.call(h[l].context,t,s,r);break;default:if(!a)for(u=1,a=new Array(v-1);u<v;u++)a[u-1]=arguments[u];h[l].fn.apply(h[l].context,a)}}return!0},c.prototype.on=function(e,t,n){return i(this,e,t,n,!1)},c.prototype.once=function(e,t,n){return i(this,e,t,n,!0)},c.prototype.removeListener=function(e,t,s,r){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return o(this,i),this;var c=this._events[i];if(c.fn)c.fn!==t||r&&!c.once||s&&c.context!==s||o(this,i);else{for(var a=0,l=[],h=c.length;a<h;a++)(c[a].fn!==t||r&&!c[a].once||s&&c[a].context!==s)&&l.push(c[a]);l.length?this._events[i]=1===l.length?l[0]:l:o(this,i)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,e.exports=c},107:(e,t,n)=>{const{Client:s}=n(102),{asProxyService:r,createProxyService:i}=n(473),o={asProxyService:r,createProxyService:i},{createRpcService:c,RpcServer:a,RpcClient:l,RpcMessageType:h}=n(475);e.exports={Client:s,createRpcService:c,RpcServer:a,RpcClient:l,RpcMessageType:h,ProxyHelper:o}}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,n),i.exports}(()=>{const e=n(107);console.log(e);const{Client:t,ProxyHelper:s}=n(107),r=n(34),i=new t(window.ipcRenderer,new r),o=e=>s.createProxyService(i,e),c=e=>{document.getElementById("result").innerText=JSON.stringify(e,null,2)},a={openLink:async()=>{const e=o("window"),t=await e.createMyShell();s.asProxyService(t).openExternal("https://google.com")},maximize:()=>{o("window").maximize()},restore:()=>{o("window").restore()},test:async()=>{const e=o("window");e.once("blur",(()=>{c("blur")}));let t=0;const n=()=>{t+=1,c(`focus ${t}`),t>=4&&e.off("focus",n)};e.on("focus",n),e.on("resize",(e=>{c(e)}))}};["openLink","maximize","restore","test"].forEach((e=>{document.getElementById(e).addEventListener("click",(()=>{const t=a[e];t&&t()}))}))})()})();